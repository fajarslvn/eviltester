!function(){function i(){g=this}var g,a=new i,b="1.1.3",c="web-sdk.control.kochava.com/track/json",d="web-sdk.control.kochava.com/v1/cpi/identityLink.php",e=20,f=6e4;if("undefined"!=typeof window){var h=window.kochava;window.kochava=a}i.prototype.init=function(a,b,c){g.startTime=a,g.appID=b,g.page_name=k(),g.utm=q("ko_click_id",b+"_click"),g.verbose=c||!1,"undefined"!=typeof console&&"undefined"!=typeof console.log?g.logging=!0:g.logging=!1;var d=q("kv_id","kv_id");g.kvID=""==d?u():d,""==d&&g.install()},i.prototype.identify=function(a,b){var c;if(c="string"==typeof a?JSON.stringify({custom_id:a}):JSON.stringify(a)||"",""!=c?(g.customTraits=c,s("c_trt",g.customTraits)):g.customTraits=r("c_trt"),""!=g.customTraits)try{var f=g.getIdentityPayload(g.customTraits),h={method:"POST",endpoint:d,body:f,contentType:"application/json",retries:e};g.verbose&&g.logging&&console.log("kochava.identify request: ",h),j(h,b)}catch(a){g.verbose&&g.logging&&console.log("kochava.identify error: ",a.message)}},i.prototype.activity=function(a,b,d){a=a||"";try{var f=g.getPayload(a,b),h={method:"POST",endpoint:c,body:f,contentType:"application/json",retries:e};g.verbose&&g.logging&&console.log("kochava request: ",h),j(h,d)}catch(a){g.verbose&&g.logging&&console.log("kochava error: ",a.message)}},i.prototype.page=function(a,b,c){g.page_name=a||g.page_name,g.activity("page",b,c)},i.prototype.conversion=function(a,b,c){a=a||"",g.activity("conversion_"+a,b,c)},i.prototype.install=function(a){g.activity("install",null,a)},i.prototype.getPayload=function(a,c){c=c||{};var d={kochava_app_id:g.appID,kochava_device_id:g.kvID,sdk_version:b,data:{language:m(),device_orientation:p(),user_agent:l(),device_ids:{kochava_device_id:g.kvID}}};if("install"==a)d.action="install";else if(d.action="event",d.data.event_name=a,d.data.event_data={page_name:g.page_name},"object"==typeof c)for(key in c)c.hasOwnProperty(key)&&(d.data.event_data[key]=c[key]);else null!=c&&g.verbose&&g.logging&&console.log("Unexpected type of options_array");if("page"!=a&&"install"!=a){var e=(new Date).getTime(),f=e-g.startTime;d.data.event_data.time_on_page=Math.round(f/1e3)}var h=n(),i=o();return null!=h&&(d.data.disp_w=h),null!=i&&(d.data.disp_h=i),"string"==typeof g.utm&&""!=g.utm&&(d.data.conversion_data={},d.data.conversion_data.utm_source=g.utm),d},i.prototype.getIdentityPayload=function(a){var b={kochava_app_id:g.appID,device_id:{kochava_device_id:g.kvID}};if(""!=a)try{b.data=JSON.parse(a)}catch(a){g.verbose&&g.logging&&console.log("Error parsing custom_trait JSON: ")}return b};var j=function(a,b){var c=a.method||"GET",d=a.endpoint,h=a.body||{},i=a.contentType||"application/json",k=a.retries;d="undefined"!=typeof document?("https:"===document.location.protocol?"https://":"http://")+d:"https://"+d,h="application/json"===i?JSON.stringify(h):h,"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}throw new Error("This browser does not support XMLHttpRequest.")});try{var l=new XMLHttpRequest}catch(a){return g.verbose&&g.logging&&console.log("Error completing request: ",a),void("function"==typeof b&&b(!0,null))}l.open(c,d,!0),i&&l.setRequestHeader("Content-Type",i),l.onerror=function(){if(k--,k>0){g.verbose&&g.logging&&console.log("Error: API call failed at the network level. Attempt:"+(e-k));var c=e-k;a.retries=k;var d=c*c*500;d>f&&(d=f),setTimeout(function(){j(a,b)},d)}else g.verbose&&g.logging&&console.log("Error: API call failed at the network level (retry limit hit)."),"function"==typeof b&&b(!0,null)},l.onload=function(c){if(c=JSON.parse(l.responseText),200!=l.status){var d=c.error,h=c.error_description;if(k--,k>0){g.verbose&&g.logging&&console.log("Error ("+l.status+")("+d+"): "+h);var i=e-k;a.retries=k;var m=i*i*500;m>f&&(m=f),setTimeout(function(){j(a,b)},m)}else g.verbose&&g.logging&&console.log("Error (retry limit hit) ("+l.status+")("+d+"): "+h),"function"==typeof b&&b(!0,c)}else g.verbose&&g.logging&&console.log("event sent successfully"),"function"==typeof b&&b(!1,c)},l.send(h)},k=function(){var a="";return"undefined"!=typeof location&&(a=location.pathname.substring(1),a=a.replace(/\/+$/,"")),""==a?"/":a},l=function(){return"undefined"!=typeof navigator?navigator.userAgent:""},m=function(){return"undefined"!=typeof navigator?navigator.language:""},n=function(){return"undefined"!=typeof window?window.screen.availWidth:null},o=function(){return"undefined"!=typeof window?window.screen.availHeight:null},p=function(){return"undefined"!=typeof window?window.innerWidth<window.innerHeight?"portrait":"landscape":""},q=function(a,b){var c=t(a);return""==c?c=r(b):s(b,c),null===c?"":c},r=function(a){if("undefined"==typeof localStorage)return"";var b;try{b=localStorage.getItem(a)}catch(a){return""}return null===b?"":b},s=function(a,b){if("undefined"==typeof localStorage)return!1;try{localStorage.setItem(a,b)}catch(a){return!1}return!0},t=function(a){if("undefined"==typeof location||"undefined"==typeof location.search)return"";a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},u=function(){var a=v();return s("kv_id",a),a},v=function(){var a=(new Date).getTime(),b="kwxxxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b},w=function(a){return!!(a&&a.constructor&&a.call&&a.apply)};if("undefined"!=typeof exports&&(exports.Kochava=i),h)for(;args=h.shift();){var x=args.shift();w(a[x])&&a[x].apply(this,args)}}();